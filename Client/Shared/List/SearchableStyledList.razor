@using Client.Shared.Buttons
@using Client.Shared.Text
@using Microsoft.AspNetCore.Components.Authorization
@typeparam TItem where TItem : notnull

@Body

@code {

    private RenderFragment Body => @<div>
        @FiltersContent
        @ButtonsContent
        @List
    </div>;

    private RenderFragment FiltersContent => @<RadzenStack
                                                  Orientation=@Orientation.Vertical
                                                  AlignItems=@AlignItems.Center>
        @Filters
        @Search
        @FilterButtons
    </RadzenStack>;

    private RenderFragment FilterButtons => @<RadzenStack
                                                 Orientation="Orientation.Horizontal"
                                                 JustifyContent="JustifyContent.SpaceBetween"
                                                 AlignItems="AlignItems.Center">
                                                <RadzenButton Click="@LoadItems" Text="Применить фильтр"/>
                                                <RadzenButton Click="@ClearFilters" Text="Сбросить фильтр"/>
                                            </RadzenStack>;

    private RenderFragment ButtonsContent => @<RadzenStack
                                                  Style="padding-top:10px"
                                                  Orientation=@Orientation.Horizontal
                                                  AlignItems=@AlignItems.Center
                                                  JustifyContent=@JustifyContent.SpaceBetween>
                                                 @LinkToCreate
                                                 @* @EmptyListButton *@
                                             </RadzenStack>;

    private RenderFragment LinkToCreate => @<AuthorizeView Roles="Ctt">
                                               <NavigationButton Path=@CreateHref Text=@CreateText/>
                                           </AuthorizeView>;


    private RenderFragment List => @<RadzenDataList
                                        WrapItems=false
                                        AllowVirtualization=false
                                        TItem=@TItem
                                        Data=@ShowedItems
                                        IsLoading=@isLoading
                                        Count=@ShowedItems.Count()
                                        PageSize="5"
                                        LoadData=@LoadItems
                                        ShowEmptyMessage=true>
                                       <Template>
                                           @Row(context)
                                       </Template>
                                       <EmptyTemplate>
                                           Список пуст
                                       </EmptyTemplate>
                                   </RadzenDataList>;

    private RenderFragment Row(TItem item) => @<RadzenLink
                                                   Style="text-decoration:none;color:unset;width:100%;height:100%;"
                                                   Path=@RowHref(item)
                                                   Text=@item.ToString()/>;

    @* private RenderFragment EmptyListButton => @<RadzenButton Icon="cached" Click=@(() => LoadItems()) ButtonStyle=@ButtonStyle.Primary/>; *@

    private RenderFragment Search => @<RadzenTextBox Placeholder=@NameFilterTitle @bind-Value=@namesFilter />;
}