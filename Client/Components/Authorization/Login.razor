@page "/login"
@using Client.Services.Authorization
@using Microsoft.AspNetCore.Components.Forms
@using Model.Identity
@inject IAuthenticationService AuthenticationService
@inject NavigationManager NavigationManager

<RadzenLogin
    Login=@LoginAction
    LoginText="Войти"
    UserText="Пользователь"
    PasswordText="Пароль"
    ShowLoginButton=@true
    AllowRegister=false
    AllowRememberMe=false
    AllowResetPassword=false/>

@code {
    [Parameter] public string Action { get; set; } = string.Empty;
    [SupplyParameterFromQuery] private string? ReturnUrl { get; set; } = "/";
    private AuthRequest AuthRequest { get; } = new();
    private bool ShowAuthError { get; set; }
    private string Error { get; set; } = default!;

    private Task ExecuteLogin()
    {
        ShowAuthError = false;
        return ExecuteLoginAction(AuthRequest);
    }

    private Task LoginAction(LoginArgs login) => ExecuteLoginAction(new()
    {
        Login = login.Username,
        Password = login.Password
    });

    private async Task ExecuteLoginAction(AuthRequest authRequest)
    {
        await AuthenticationService.Login(authRequest);
        NavigationManager.NavigateTo(ReturnUrl ?? "/");
    }

}